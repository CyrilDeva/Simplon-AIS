# Vulnerability Report
## CWE-22 Relative Path Traversal
### Common Vulnerability Scoring System (CVSS)
**6.3**

### Description
The product uses external input to construct a pathname that should be within a restricted directory, but it does not properly neutralize sequences such as ".." that can resolve to a location that is outside of that directory.

### Evidence / Preuve
![alt text](<Screenshots Pentest/logs1.png>)
![alt text](<Screenshots Pentest/logs2.png>)
### Steps to reproduce / Étapes de reproduction
Input the following in a terminal
```
curl -X 'GET' 'https://localhost:3000/?lang=VulnerableClass.cs' -H 'accept: application/json'
```
### Recommendations / Préconisations
**Principle of Least Privilege**: Grant users and software components only the privileges necessary to perform their assigned tasks. Limit access to sensitive resources only to authorized users.

**Regular Privilege Reviews**: Conduct regular privilege reviews to ensure that users have not acquired excessive or inappropriate rights. Revoke privileges that are no longer necessary.

**Password Policies**: Implement robust password policies, including requirements for minimum length, complexity, and periodic rotation. Encourage the use of multi-factor authentication where possible.

**Audit Log Monitoring**: Establish monitoring of audit logs to detect suspicious activities or unauthorized access attempts. Respond promptly to these incidents and investigate root causes.

**Environment Separation**: Separate development, testing, and production environments to reduce the risk of compromising production systems through attacks against less secure development systems.

**Education and Awareness**: Educate users and developers about security best practices, including privilege management and protection of sensitive information. Provide training on how to identify and report suspicious activities.

**Updates and Patches**: Keep all systems, software, and devices up to date with the latest security patches. Identify and promptly address known vulnerabilities that could be exploited to gain unauthorized privileges.

**Regular Security Testing**: Conduct regular security testing, including vulnerability scans and penetration tests, to detect and remediate configuration and privilege management weaknesses before they are exploited by adversaries.

### References

https://cwe.mitre.org/data/definitions/23.html

## CWE-79 Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')
### Common Vulnerability Scoring System (CVSS)
7.6
### Description
The product constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended OS command when it is sent to a downstream component

### Evidence / Preuve
![alt text](<Screenshots Pentest/logsAlert2.png>)
### Steps to reproduce / Étapes de reproduction

Enter the following command in the terminal
```
curl -X 'GET' 'https://localhost:3000/Log?i=%3Cscript%3Ealert%28%22toto%22%29%3B%3C%2Fscript%3E'
 -H 'accept: text/plain'
```

### Recommendations / Préconisations
**Input Validation**: Implement strict input validation mechanisms to ensure that all user-supplied data is validated and sanitized before processing. Use whitelisting or input validation libraries to reject or sanitize inputs that do not conform to expected patterns or formats.

**Parameterized Queries**: Use parameterized queries or prepared statements when interacting with databases to prevent SQL injection attacks. Parameterization separates SQL code from user input, making it impossible for attackers to inject malicious SQL commands.

**Escape Special Characters**: If parameterized queries are not feasible, escape special characters in user input before incorporating them into SQL queries. This prevents attackers from exploiting SQL injection vulnerabilities by neutralizing the special meaning of characters like quotes and semicolons.

**Least Privilege Principle**: Restrict database privileges to the minimum necessary for each user or application. Avoid using privileged accounts for routine operations and limit the scope of database access to reduce the impact of successful SQL injection attacks.

**Secure Coding Practices**: Train developers on secure coding practices to prevent SQL injection vulnerabilities. Emphasize the importance of validating and sanitizing input data, using parameterized queries, and avoiding dynamic SQL construction.

**Input Sanitization**: Implement input sanitization routines to remove or neutralize potentially harmful characters or sequences from user input. This can include removing or encoding characters with special significance in SQL queries, such as single quotes and SQL keywords.

**Web Application Firewalls (WAFs)**: Deploy WAFs to detect and block SQL injection attempts at the network perimeter. Configure WAFs to apply strict rules for filtering and sanitizing incoming requests to prevent malicious SQL injection payloads from reaching the application.

**Regular Security Audits**: Conduct regular security audits and code reviews to identify and remediate SQL injection vulnerabilities in both new and existing code. Use automated tools and manual inspection techniques to thoroughly examine application code for potential weaknesses.

**Security Headers**: Implement security headers, such as Content Security Policy (CSP) and X-XSS-Protection, to provide an additional layer of defense against SQL injection and other web-based attacks. These headers can help mitigate the impact of successful exploitation by controlling how browsers handle potentially malicious content.

**Security Training and Awareness**: Educate developers, testers, and administrators about the risks associated with SQL injection and other injection attacks. Provide training on secure coding practices, vulnerability detection, and incident response procedures to empower personnel to identify and address SQL injection vulnerabilities effectively.

### References
https://cwe.mitre.org/data/definitions/78.html

## CWE-798 Use of Hard-coded Credentials
### Common Vulnerability Scoring System (CVSS)
9.8

### Description

The product contains hard-coded credentials, such as a password or cryptographic key, which it uses for its own inbound authentication, outbound communication to external components, or encryption of internal data. 

### Evidence / Preuve
In VulnerableClass.cs, line 131
```
 table.Rows.Add("root", "ce5ca673d1
 table.Rows.Add("admin", "8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918");
 table.Rows.Add("user", "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855");
```

### Steps to reproduce / Étapes de reproduction

Open the source code, In VulnerableClass.cs, line 131

### Recommendations / Préconisations

**Use Credential Management Systems**: Implement a secure credential management system that allows for the secure storage and retrieval of credentials. This could involve using a dedicated credential management tool or framework provided by your platform or using a third-party solution.

**Store Credentials in Secure Locations**: Store credentials in secure locations such as encrypted configuration files, environment variables, or secure storage services. Avoid storing credentials directly in source code or in plain text files.

**Use Encryption**: If you must store credentials in files or databases, ensure that they are encrypted using strong encryption algorithms. This adds an additional layer of security and helps protect the credentials if they are compromised.

### References

* CWE : https://cwe.mitre.org/data/definitions/798.html



## CWE-639: Authorization Bypass Through User-Controlled Key

### Common Vulnerability Scoring System (CVSS)

5.5

### Description

The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data. 

### Evidence / Preuve
![alt text](<Screenshots Pentest/addr.png>)
![alt text](<Screenshots Pentest/addr2.png>)


### Steps to reproduce / Étapes de reproduction
Get the token by putting

**1' or '1'='1** in the user field

**password:*/=1--** in the password field

Result will output the token
![Auth result woth token](<Screenshots Pentest/Auth2.png>)

With the token
we can use :

```
https://localhost:3000/Addr?i=42&t=**eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImFkbWluIiwibmJmIjoxNzA3OTI3MDM2LCJleHAiOjE3Mzk0NjMwMzYsImlhdCI6MTcwNzkyNzAzNn0.fnSa3tBfj3
```
It will output :
![alt text](<Screenshots Pentest/addr2.png>)

### Recommendations / Préconisations

**Use Strong, Randomly Generated Keys**: Instead of hard-coding the secret key, generate it using a secure random number generator or a cryptographic key generation library. This ensures that the key is unpredictable and resistant to brute-force attacks.

**Store Keys Securely**: Store the generated keys securely, preferably in a dedicated credential management system or encrypted configuration files. Avoid storing keys directly in source code or in plaintext files.

**Use Key Management Best Practices**: Follow industry best practices for key management, such as limiting access to keys based on the principle of least privilege, logging key usage, and monitoring for suspicious activity.

### References

* CWE : https://cwe.mitre.org/data/definitions/639.html


## CWE-434: Unrestricted Upload of File with Dangerous Type

### Common Vulnerability Scoring System (CVSS)

8.6

### Description

The product allows the attacker to upload or transfer files of dangerous types that can be automatically processed within the product's environment. 

### Evidence / Preuve


### Steps to reproduce / Étapes de reproduction

![alt text](<Screenshots Pentest/Fileupload.png>)
The Logs.html file was replaced in the server

### Recommendations / Préconisations

**Input Validation**: Validate and sanitize the file name to prevent directory traversal attacks. Only allow alphanumeric characters and restrict file paths to a specific directory.

**File Permissions**: Ensure that uploaded files have appropriate permissions set to prevent unauthorized access. Set secure file permissions (e.g., read and write permissions for the owner only).

**File Type Validation**: Implement file type checking based on file extension or content validation to ensure that only allowed file types are uploaded. Use a whitelist approach rather than a blacklist to avoid overlooking potential threats.

**File Size Limit**: Enforce a maximum file size limit to prevent DoS attacks. Reject files that exceed the specified size limit and provide appropriate error messages to users.


### References

* CWE : https://cwe.mitre.org/data/definitions/434.html


